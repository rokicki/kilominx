This repository is data and code for the paper "Notes on the Kilominx"
by Tomas Rokicki, submitted to the Gathering for Gardner 16 held in
February 2026.

Everything here was executed on Mac OSX from the command line.  Using
Linux should nearly identical.  You may have to adjust -M options to
suit the memory of your machine (I recommend using half the physical
memory).

We assume this directory can be invoked with ~/kilominx, and that
https://github.com/cubing/cubing.js and https://github.com/twsearch
are cloned into ~/cubing.js and ~/twsearch, respectively.  We assume
you have a C++ compiler to compile twsearch and that you have installed
bun.

To build cubing.js, cd into that directory and type

	make setup
	make build

To build twsearch, cd into that directory and type

	make

The first thing we need to do is create some files for twsearch to use.
To do this, make sure you are in the cubing.js directory (to help
bun find its files).  The kilominx is not one of the predefined puzzles
in cubing.js, but it is just a megaminx without centers or edges.  So we
can create a basic kilominx file for twsearch with the following command:

	bun src/bin/puzzle-geometry-bin.ts --ksolve --rotations --optimize --nocenters --noedges megaminx > ~/kilominx/kilominx.tws

We say we want a ksolve file (which is the base of the tws file format),
and we want all the rotations of the puzzle, and we'd like it to simplify
if it can, and we don't want centers or edges.

You can also ask cubing.js what the state space of the kilominx is, with

	bun src/bin/puzzle-geometry-bin.ts --ss --nocenters --noedges megaminx

and on the last line we see the value 1.413.834.128.545.313.800.765,440,000
which is 1.4e27, the size of the large group, which considers only a single
rotation of the puzzle to be solved.  Luckily, cubing.js knows all about
holding a corner stationary and calculating the size of the small group:

	bun src/bin/puzzle-geometry-bin.ts --ss --fixcorner --nocenters --noedges megaminx

which gives the value 23.563.902.142.421.896.679.424,000 or about 2.4e25.
We also need a twsearch file that handles the small group, so we generate
it here.  We don't know what corner cubing.js will select, though, so we
do this by specifying what moves to include:

	bun src/bin/puzzle-geometry-bin.ts --ksolve --moves U,F,R,L,BL,BR,DR,FR,FL,u,f,r --rotations --optimize --nocenters --noedges megaminx > ~/kilominx/kilominxfc.tws

Next, to get the information about possible orders and short routines
that generate it, we can use the twsearch --ordertree option.  We have to
let it run for a while and then control-C it though, because it is not
smart enough to know when all orders have been found.  To do this, we
cd back into the kilominx directory and run:

	~/twsearch/build/bin/twsearch --ordertree kilominx.tws | tee ordertree.log

and we give it say 15 minutes to run, and then hit control-C once we see
the hard states (110, 234, and 378) show up.

Next, we see if we can find the solution to a full puzzle rotation like Uv
(also known by its default name of y) from twsearch.  This requires a
bit of time and memory, but this is how I ran it on my machine:

	~/twsearch/build/bin/twsearch --nowrite -M 32768 --scramblealg y kilominx.tws

It took about twenty minutes to find the solution in the paper.  We ran it
similarly for the other rotations we were interested in.

To investigate subsets of moves and which generate the group, we can
generate a kilominx tws file that has many more possible moves.
We go back to the cubing.js and execute:

	bun src/bin/puzzle-geometry-bin.ts --ksolve --rotations --optimize --nocenters --noedges --moves U,F,R,L,BR,BL,u,f,r,l,br,bl,2U,2F,2R,2L,2BR,2BL,d,b,FR,FL,DR,DL megaminx > ~/kilominx/kilominxall.tws

Now we can use this to verify (for instance) that the full group is
generated by just r and l.  Go back to the kilominx directory and type:

	~/twsearch/build/bin/twsearch --schreiersims --moves l,r kilominxall.tws

and it should show that the size is 1.4e27, the full group.  We can find a
solution to U in l and r with

	~/twsearch/build/bin/twsearch --nowrite --scramblealg U --moves l,r kilominxall.tws

To get canonical sequences, we can run

	~/twsearch/build/bin/twsearch -C19 kilominx.tws

The output is in this repository under canonical-faceturn.log.  Note that the
output also includes the branching factor at each level.  For the
quantum-turn metric, just add -q:

	~/twsearch/build/bin/twsearch -q -C19 kilominx.tws

This output is in the canonical-quarterturn.log.

To get as far as we could in counting state counts by distance, we ran on
a 1.5TB machine, so the -M option below is likely not something you can
run on your machine.  Adjust it as you need.  For the face-turn metric,
we ran:

	~/twsearch/build/bin/twsearch -F -M 1400000 -g kilominx/kilominx.tws

and we have saved the output under kilominx-g.log.  For the quantum-turn
metric, we ran

	~/twsearch/build/bin/twsearch -F -M 1400000 -g -q kilominx/kilominx.tws

and the output is in kilominx-g-q.log.  For the fixed-corner move set in
the face-turn metric, we used

	~/twsearch/build/bin/twsearch -F -M 1400000 -g kilominx/kilominxfc.tws

and the output is in kilominx-fc-g.log, and for the fixed-corner move set
in the quantum-turn metric, we used

	~/twsearch/build/bin/twsearch -F -M 1400000 -g -q kilominx/kilominxfc.tws

and the output is in kilominx-fc-g-q.log.

To attempt optimal solving, we used the following command:

	~/twsearch/build/bin/twsearch -S1017 --nowrite -M 1400000 --newcanon 3 kilominxfc.tws

The --newcanon 3 option significantly decreases the branching factor for
the search when we don't have a lot of moves that commute, and for this
move set, the moves u, r, and f don't commute with anything.  This is just
another type of canonical sequences but we don't describe it in the paper.
Anyway, the output is stored in randomfc.log just so you can see how long
it took.  The "found 1 solution" initially with an empty string is because
with the -S option, we always `solve' the solved position first.
